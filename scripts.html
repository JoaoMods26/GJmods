<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>joao_mods</title>

 <link rel="icon" type="image/png" href="https://i.ibb.co/Vcbqr6wC/Srudios.png">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
<style>
        /* Estilos CSS originales */
        :root{--color-black:#0a0a0a;--color-white:#ffffff;--color-primary:#1e40af;--color-secondary:#dc2626;--color-accent:#3b82f6;--glass-bg:rgba(255, 255, 255, 0.05);--glass-border:rgba(255, 255, 255, 0.1);--color-success:#28a745}.navbar{position:fixed;top:0;left:0;right:0;height:60px;background:rgba(10, 10, 10, 0.95);border-bottom:1px solid var(--glass-border);z-index:1000}.navbar-container{max-width:1200px;margin:0 auto;height:100%;display:flex;align-items:center;justify-content:space-between;padding:0 1rem}.navbar-logo{font-size:1.4rem;font-weight:700;color:var(--color-accent);cursor:pointer}.navbar-nav{display:flex;gap:1rem;list-style:none;margin:0;padding:0}.nav-link{color:rgba(255, 255, 255, 0.8);text-decoration:none;padding:0.5rem 1rem;border-radius:4px;font-weight:500}.nav-link:hover,.nav-link.active{color:var(--color-white);background:var(--glass-bg)}*{box-sizing:border-box}body{font-family:'Inter', sans-serif;background-color:var(--color-black);color:var(--color-white);margin:0;padding:0;padding-top:60px;line-height:1.5}.container{max-width:1200px;margin:0 auto;padding:1rem}.main-content{min-width:0}.header{text-align:center;padding:1rem 0;margin-bottom:1rem;position:relative}.logo{font-size:2.5rem;font-weight:700;color:var(--color-accent);margin:0}.search-section{margin-bottom:2rem}.search-container{background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:8px;padding:1.5rem;margin-bottom:1rem}.search-form{display:flex;gap:0.5rem;margin-bottom:1rem;flex-wrap:wrap}.search-input{flex:1;min-width:250px;padding:0.75rem;background:rgba(255, 255, 255, 0.1);border:1px solid var(--glass-border);border-radius:4px;color:var(--color-white);font-size:1rem}.search-input:focus{outline:none;border-color:var(--color-accent)}.search-input::placeholder{color:rgba(255, 255, 255, 0.5)}.search-btn,.trending-btn{padding:0.75rem 1.5rem;border:none;border-radius:4px;font-weight:600;cursor:pointer;color:white}.search-btn{background:var(--color-primary)}.trending-btn{background:var(--color-secondary)}.search-btn:hover{background:var(--color-accent)}.search-btn:disabled{opacity:0.5;cursor:not-allowed}.api-selector{display:flex;gap:0.5rem;align-items:center;margin-bottom:1rem}.api-selector label{color:rgba(255, 255, 255, 0.8);font-weight:600}.api-toggle{display:flex;background:rgba(255, 255, 255, 0.1);border-radius:4px;border:1px solid var(--glass-border)}.api-option{padding:0.5rem 1rem;background:none;border:none;color:rgba(255, 255, 255, 0.7);cursor:pointer;font-size:0.9rem}.api-option.active{background:var(--color-accent);color:white}.filters-container{display:flex;gap:0.5rem;flex-wrap:wrap;align-items:center}.filter-select{padding:0.5rem;background:rgba(255, 255, 255, 0.1);border:1px solid var(--glass-border);border-radius:4px;color:var(--color-white);font-size:0.9rem;cursor:pointer}.filter-select option{background:var(--color-black)}.results-section{margin-bottom:2rem}.results-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;flex-wrap:wrap;gap:0.5rem}.results-count{font-size:1rem;color:var(--color-accent);font-weight:600}.scripts-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(350px, 1fr));gap:1rem}.script-card{background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:8px;padding:1rem;border-top:3px solid var(--color-accent)}.script-card:hover{border-color:var(--color-accent)}.script-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:0.5rem;gap:0.5rem}.script-title{font-size:1.1rem;font-weight:600;color:var(--color-white);margin:0;line-height:1.2}.script-game{background:var(--color-accent);color:white;padding:0.2rem 0.5rem;border-radius:12px;font-size:0.75rem;font-weight:600;white-space:nowrap}.script-description{color:rgba(255, 255, 255, 0.8);font-size:0.9rem;margin-bottom:0.5rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.script-tags{display:flex;flex-wrap:wrap;gap:0.25rem;margin-bottom:0.5rem}.script-tag{background:rgba(255, 255, 255, 0.1);color:rgba(255, 255, 255, 0.8);padding:0.15rem 0.4rem;border-radius:10px;font-size:0.7rem}.script-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem;font-size:0.8rem;color:rgba(255, 255, 255, 0.6)}.script-actions{display:flex;gap:0.5rem}.copy-btn,.view-btn{flex:1;padding:0.5rem;border:none;border-radius:4px;font-weight:600;cursor:pointer;font-size:0.9rem;color:white}.copy-btn{background:var(--color-success)}.view-btn{background:var(--color-primary);text-decoration:none;text-align:center}.loading{text-align:center;padding:2rem 0}.spinner{border:3px solid rgba(255, 255, 255, 0.1);border-top:3px solid var(--color-accent);border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;margin:0 auto 1rem auto}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.no-results{text-align:center;padding:2rem 0;color:rgba(255, 255, 255, 0.6)}.pagination{display:flex;justify-content:center;align-items:center;gap:0.5rem;margin-top:1rem;flex-wrap:wrap;padding:1rem;background:var(--glass-bg);border-radius:8px;border:1px solid var(--glass-border)}.page-btn{min-width:35px;height:35px;padding:0.5rem;background:var(--glass-bg);border:1px solid var(--glass-border);color:var(--color-white);border-radius:4px;cursor:pointer;font-weight:500;font-size:0.9rem;display:flex;align-items:center;justify-content:center}.page-btn:hover:not(:disabled){background:rgba(255, 255, 255, 0.1);border-color:var(--color-accent)}.page-btn.active{background:var(--color-accent);border-color:var(--color-accent);color:white;font-weight:600}.page-btn:disabled{opacity:0.4;cursor:not-allowed}.pagination-dots{color:rgba(255, 255, 255, 0.5);padding:0 0.5rem}.notification{position:fixed;top:80px;right:20px;padding:0.75rem 1rem;border-radius:4px;font-weight:600;z-index:1000;transform:translateX(300px);transition:transform 0.2s ease}.notification.show{transform:translateX(0)}.notification.success{background:var(--color-success)}.notification.error{background:var(--color-secondary)}.modal{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0, 0, 0, 0.8);display:flex;align-items:center;justify-content:center;z-index:2000;opacity:0;visibility:hidden;transition:all 0.2s ease}.modal.show{opacity:1;visibility:visible}.modal-content{background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:8px;padding:1.5rem;max-width:90vw;max-height:90vh;overflow-y:auto;position:relative}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;border-bottom:1px solid var(--glass-border);padding-bottom:0.5rem}.close-btn{background:none;border:none;color:var(--color-white);font-size:1.5rem;cursor:pointer;padding:0.25rem;border-radius:4px}.close-btn:hover{background:rgba(255, 255, 255, 0.1)}.script-code{background:#1a1a2e;border:1px solid var(--glass-border);border-radius:4px;padding:1rem;font-family:'Consolas', 'Monaco', 'Courier New', monospace;font-size:0.85rem;line-height:1.4;color:#e2e8f0;max-height:400px;overflow-y:auto;white-space:pre-wrap;word-break:break-all}.api-status{display:flex;justify-content:center;margin-bottom:0.5rem}.api-indicator{padding:0.25rem 0.75rem;border-radius:12px;font-size:0.75rem;font-weight:600;display:flex;align-items:center;gap:0.5rem}.api-indicator.loading{background:#ffc107;color:#000}.api-indicator.success{background:var(--color-success);color:white}.api-indicator.error{background:var(--color-secondary);color:white}.status-dot{width:8px;height:8px;border-radius:50%;background:currentColor}

/* Estilos para anuncios */
.ad-container {
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.2s ease;
}

.ad-container:hover {
    transform: scale(1.02);
}

.ad-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 4px;
}

/* Anuncios laterales del header */
.header-ads-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    transform: translateY(-50%);
    pointer-events: none;
    z-index: 1;
}

.header-ad {
    width: 200px;
    height: 100px;
    pointer-events: auto;
}

.header-content {
    position: relative;
    z-index: 2;
}

/* Anuncios al final */
.bottom-ads-section {
    margin: 3rem 0 2rem 0;
    padding: 2rem 0;
    border-top: 2px solid var(--glass-border);
}

.bottom-ads-title {
    text-align: center;
    color: var(--color-accent);
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 2rem;
}

.bottom-ads-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    justify-items: center;
}

.bottom-ad {
    width: 100%;
    max-width: 400px;
    height: 200px;
}

/* Responsive design */
@media (max-width: 768px) {
    .container{padding:0.5rem}.search-form{flex-direction:column}.search-input{min-width:100%}.scripts-grid{grid-template-columns:1fr}.filters-container{flex-direction:column;align-items:stretch}.results-header{flex-direction:column;align-items:stretch}.script-actions{flex-direction:column}.navbar-nav{display:none}.modal-content{margin:0.5rem;max-width:calc(100vw - 1rem);max-height:calc(100vh - 1rem)}.pagination{gap:0.25rem}.page-btn{min-width:30px;height:30px;padding:0.25rem;font-size:0.8rem}.logo{font-size:2rem}.api-selector{flex-direction:column;align-items:stretch}
    
    /* Anuncios móvil */
    .header-ads-container {
        position: static;
        transform: none;
        flex-direction: column;
        gap: 1rem;
        margin: 1rem 0;
    }
    
    .header-ad {
        width: 100%;
        max-width: 300px;
        height: 80px;
    }
    
    .bottom-ads-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .bottom-ad {
        max-width: 100%;
        height: 150px;
    }
    
    .bottom-ads-title {
        font-size: 1.2rem;
        margin-bottom: 1rem;
    }
}

/* Ocultar anuncios en pantallas muy pequeñas */
@media (max-width: 480px) {
    .header-ad {
        height: 60px;
    }
    
    .bottom-ad {
        height: 120px;
    }
}

.script-card,.page-btn,.search-btn,.trending-btn,.copy-btn,.view-btn{will-change:auto}*{transition:none}.search-btn:hover,.copy-btn:hover,.view-btn:hover,.page-btn:hover:not(:disabled){transition:background-color 0.1s ease}
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar" id="navbar">
<div class="navbar-container">
<div class="navbar-logo" onclick="window.location.href='index.html'">GJMODS</div>
<ul class="navbar-nav">
<li class="nav-item">
<a class="nav-link" href="index.html">Inicio</a>
</li>
<li class="nav-item">
<a class="nav-link active" href="#search">Buscar Scripts</a>
</li>
</ul>
</div>
</nav>

<!-- Header con anuncios laterales -->
<header class="header">
    <div class="header-ads-container">
        <!-- Primer anuncio lateral -->
        <div class="ad-container header-ad" onclick="handleAdClick('https://ejemplo.com/anuncio1')" style="cursor: pointer;" data-ad-id="header-ad-1">
            <img src="https://via.placeholder.com/200x100/3b82f6/ffffff?text=Anuncio+1" alt="Anuncio 1" loading="lazy">
        </div>
        
        <!-- Segundo anuncio lateral -->
        <div class="ad-container header-ad" onclick="handleAdClick('https://ejemplo.com/anuncio2')" style="cursor: pointer;" data-ad-id="header-ad-2">
            <img src="https://via.placeholder.com/200x100/dc2626/ffffff?text=Anuncio+2" alt="Anuncio 2" loading="lazy">
        </div>
    </div>
    
    <div class="header-content">
        <h1 class="logo">Buscador de Scripts</h1>
        <p style="color: rgba(255, 255, 255, 0.7); font-size: 1rem;">Encuentra scripts para tus juegos favoritos de Roblox</p>
    </div>
</header>

<!-- Contenido principal -->
<main class="container">
    <!-- Contenido principal -->
    <div class="main-content">
        <!-- API Status -->
        <div class="api-status" id="apiStatus">
            <div class="api-indicator" id="currentApiStatus">
                <div class="status-dot"></div>
                <span id="apiStatusText">Conectando...</span>
            </div>
        </div>

        <!-- Sección de búsqueda -->
        <section class="search-section" id="search">
            <div class="search-container">
                <!-- Selector de API -->
                <div class="api-selector">
                    <label>API:</label>
                    <div class="api-toggle">
                        <button class="api-option active" id="scriptbloxBtn" onclick="selectAPI('scriptblox')">
                            ScriptBlox
                        </button>
                        <button class="api-option" id="rscriptsBtn" onclick="selectAPI('rscripts')">
                            RScripts
                        </button>
                    </div>
                </div>

                <form class="search-form" id="searchForm">
                    <input autocomplete="off" class="search-input" id="searchInput" placeholder="Buscar scripts por nombre de juego..." type="text"/>
                    <button class="search-btn" id="searchBtn" type="submit">
                        Buscar Scripts
                    </button>
                    <button class="trending-btn" onclick="loadTrendingScripts()" type="button">
                        Recientes
                    </button>
                </form>
                <div class="filters-container">
                    <select class="filter-select" id="sortFilter">
                        <option value="date">Más recientes</option>
                        <option value="views">Más vistos</option>
                        <option value="likes">Más gustados</option>
                    </select>
                    <select class="filter-select" id="orderFilter">
                        <option value="desc">Descendente</option>
                        <option value="asc">Ascendente</option>
                    </select>
                    <select class="filter-select" id="verifiedFilter">
                        <option value="">Todos</option>
                        <option value="true">Solo verificados</option>
                    </select>
                    <button class="search-btn" onclick="clearSearch()" style="background: #6c757d;">
                        Limpiar
                    </button>
                </div>
            </div>
        </section>

        <!-- Sección de resultados -->
        <section class="results-section" id="results">
            <div class="results-header" id="resultsHeader" style="display: none;">
                <div class="results-count" id="resultsCount"></div>
                <div class="sort-container">
                    <span style="color: rgba(255, 255, 255, 0.6); margin-right: 0.5rem;">Página:</span>
                    <span id="pageInfo" style="color: var(--color-accent); font-weight: 600;"></span>
                </div>
            </div>
            <div class="loading" id="loadingState" style="display: none;">
                <div class="spinner"></div>
                <p>Buscando scripts...</p>
            </div>
            <div class="no-results" id="noResults" style="display: none;">
                <h3>Sin resultados</h3>
                <p>No se encontraron scripts para tu búsqueda. Intenta con otros términos.</p>
            </div>
            <div class="scripts-grid" id="scriptsGrid">
                <!-- Los scripts se cargarán aquí dinámicamente -->
            </div>
            <div class="pagination" id="pagination" style="display: none;">
                <!-- La paginación se generará dinámicamente -->
            </div>
        </section>
        
        <!-- Sección de anuncios al final -->
        <section class="bottom-ads-section">
            <h2 class="bottom-ads-title">🎮 Contenido Patrocinado</h2>
            <div class="bottom-ads-grid">
                <!-- Anuncio 3 -->
                <div class="ad-container bottom-ad" onclick="handleAdClick('https://ejemplo.com/anuncio3')" style="cursor: pointer;" data-ad-id="bottom-ad-3">
                    <img src="https://via.placeholder.com/400x200/28a745/ffffff?text=Anuncio+3" alt="Anuncio 3" loading="lazy">
                </div>
                
                <!-- Anuncio 4 -->
                <div class="ad-container bottom-ad" onclick="handleAdClick('https://ejemplo.com/anuncio4')" style="cursor: pointer;" data-ad-id="bottom-ad-4">
                    <img src="https://via.placeholder.com/400x200/f59e0b/ffffff?text=Anuncio+4" alt="Anuncio 4" loading="lazy">
                </div>
                
                <!-- Anuncio 5 -->
                <div class="ad-container bottom-ad" onclick="handleAdClick('https://ejemplo.com/anuncio5')" style="cursor: pointer;" data-ad-id="bottom-ad-5">
                    <img src="https://via.placeholder.com/400x200/8b5cf6/ffffff?text=Anuncio+5" alt="Anuncio 5" loading="lazy">
                </div>
                
                <!-- Anuncio 6 -->
                <div class="ad-container bottom-ad" onclick="handleAdClick('https://ejemplo.com/anuncio6')" style="cursor: pointer;" data-ad-id="bottom-ad-6">
                    <img src="https://via.placeholder.com/400x200/ef4444/ffffff?text=Anuncio+6" alt="Anuncio 6" loading="lazy">
                </div>
            </div>
        </section>
    </div>
</main>

<!-- Modal para vista previa de script -->
<div class="modal" id="scriptModal">
<div class="modal-content">
<div class="modal-header">
<h3 id="modalTitle">Vista previa del script</h3>
<button class="close-btn" onclick="closeModal()">×</button>
</div>
<div id="modalBody">
<div class="script-code" id="modalCode"></div>
<div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
<button class="copy-btn" onclick="copyModalScript()" style="flex: 1;">
                        Copiar Script
                    </button>
</div>
</div>
</div>
</div>

<script>
        // ESTADO GLOBAL Y REFERENCIAS DOM
        let currentPage = 1, currentQuery = '', currentSort = 'date', currentOrder = 'desc', currentVerified = '', maxPages = 1, isShowingTrending = true, isLoading = false, currentAPI = 'scriptblox';
        const searchForm = document.getElementById('searchForm'), searchInput = document.getElementById('searchInput'), sortFilter = document.getElementById('sortFilter'), orderFilter = document.getElementById('orderFilter'), verifiedFilter = document.getElementById('verifiedFilter'), scriptsGrid = document.getElementById('scriptsGrid'), loadingState = document.getElementById('loadingState'), noResults = document.getElementById('noResults'), resultsHeader = document.getElementById('resultsHeader'), resultsCount = document.getElementById('resultsCount'), pageInfo = document.getElementById('pageInfo'), pagination = document.getElementById('pagination'), scriptModal = document.getElementById('scriptModal'), modalCode = document.getElementById('modalCode'), modalTitle = document.getElementById('modalTitle'), currentApiStatus = document.getElementById('currentApiStatus'), apiStatusText = document.getElementById('apiStatusText');
        const PROXY_BASE = 'https://workers-playground-curly-unit-2502.joao-lokofrank.workers.dev/api', SCRIPTBLOX_API = PROXY_BASE, RSCRIPTS_API = `${PROXY_BASE}/rscripts`;
        
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            loadTrendingScripts();
        });

        function setupEventListeners() {
            searchForm.addEventListener('submit', handleSearch);
            sortFilter.addEventListener('change', () => { currentSort = sortFilter.value; currentPage = 1; refreshCurrentSearch(); });
            orderFilter.addEventListener('change', () => { currentOrder = orderFilter.value; currentPage = 1; refreshCurrentSearch(); });
            verifiedFilter.addEventListener('change', () => { currentVerified = verifiedFilter.value; currentPage = 1; refreshCurrentSearch(); });
            scriptModal.addEventListener('click', (e) => { if (e.target === scriptModal) closeModal(); });
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && scriptModal.classList.contains('show')) closeModal(); });
        }

        function selectAPI(apiName) {
            currentAPI = apiName;
            currentPage = 1;
            document.querySelectorAll('.api-option').forEach(btn => btn.classList.remove('active'));
            document.getElementById(apiName + 'Btn').classList.add('active');
            apiStatusText.textContent = apiName === 'scriptblox' ? 'ScriptBlox' : 'RScripts';
            if (isShowingTrending) { loadTrendingScripts(); } else if (currentQuery) { fetchScripts(); }
            showNotification(`Cambiado a ${apiName === 'scriptblox' ? 'ScriptBlox' : 'RScripts'}`, 'success');
        }

        function updateAPIStatus(status) {
            const element = currentApiStatus;
            element.className = `api-indicator ${status}`;
            switch(status) {
                case 'loading': apiStatusText.textContent = 'Cargando...'; break;
                case 'success': apiStatusText.textContent = currentAPI === 'scriptblox' ? 'ScriptBlox ✓' : 'RScripts ✓'; break;
                case 'error': apiStatusText.textContent = currentAPI === 'scriptblox' ? 'ScriptBlox ✗' : 'RScripts ✗'; break;
            }
        }

        async function makeAPIRequest(url, options = {}) {
            try {
                const response = await fetch(url, { method: 'GET', headers: {'Accept': 'application/json', 'Content-Type': 'application/json'}, ...options });
                if (!response.ok) { throw new Error(`HTTP ${response.status}: ${response.statusText}`); }
                return await response.json();
            } catch (error) { console.error(`[API] Error:`, error); throw error; }
        }
        
        async function fetchScriptBloxScripts(query = '', page = 1) {
            updateAPIStatus('loading');
            try {
                const endpoint = query ? 'search' : 'fetch';
                const params = new URLSearchParams({ page: page });
                if (query) params.set('q', query);
                const sortMap = { 'date': 'updatedAt', 'views': 'views', 'likes': 'likes' };
                if (sortMap[currentSort]) params.set('sortBy', sortMap[currentSort]);
                params.set('order', currentOrder);
                if (currentVerified === 'true') params.set('verified', 'true');
                const url = `${SCRIPTBLOX_API}/${endpoint}?${params.toString()}`;
                const data = await makeAPIRequest(url);
                updateAPIStatus('success');
                const result = data?.result || data;
                const scripts = result?.scripts || [];
                maxPages = result?.totalPages || result?.info?.totalPages || (scripts.length === 20 ? currentPage + 1 : currentPage);
                return scripts.map(s => ({ id: s.slug || s._id, title: s.title, game: s.game?.name, description: s.description, verified: s.verified, views: s.views, likes: s.likes, patched: s.patched, universal: s.universal, keySystem: s.key, scriptType: s.scriptType, source: 'ScriptBlox', rawScript: s.script }));
            } catch (error) { updateAPIStatus('error'); return []; }
        }

        async function fetchRScriptsScripts(query = '', page = 1) {
            updateAPIStatus('loading');
            try {
                const url = query ? `${RSCRIPTS_API}/scripts?${new URLSearchParams({ page, limit: 20, q: query })}` : `${RSCRIPTS_API}/trending`;
                const data = await makeAPIRequest(url);
                updateAPIStatus('success');
                
                let scripts = [];
                if (query) {
                    scripts = data?.scripts || [];
                    maxPages = data?.info?.maxPages || 1;
                } else {
                    scripts = (data?.success || []).map(item => {
                        const scriptData = item.script || {};
                        return { ...item, ...scriptData, _id: scriptData._id || item._id };
                    });
                    maxPages = 1;
                }
                
                return scripts.map(s => ({ id: s._id, title: s.title, game: s.game?.name, description: s.description, verified: s.user?.verified, views: s.views, likes: s.likes, patched: s.patched, universal: s.universal, keySystem: s.keySystem, scriptType: 'free', source: 'RScripts', rawScript: s.rawScript }));
            } catch (error) { updateAPIStatus('error'); return []; }
        }
        
        async function fetchScriptsFromCurrentAPI(query = '', page = 1) {
            return currentAPI === 'scriptblox' ? await fetchScriptBloxScripts(query, page) : await fetchRScriptsScripts(query, page);
        }
        async function handleSearch(e) { e.preventDefault(); currentQuery = searchInput.value.trim(); if (!currentQuery) return; currentPage = 1; isShowingTrending = false; await fetchScripts(); }
        function refreshCurrentSearch() { isShowingTrending ? loadTrendingScripts() : fetchScripts(); }
        async function fetchScripts() { if (isLoading) return; isLoading = true; showLoading(true); hideAllResults(); try { const scripts = await fetchScriptsFromCurrentAPI(currentQuery, currentPage); if (scripts && scripts.length > 0) { renderScripts(scripts); updateHeader(scripts.length, currentPage, maxPages); if (!isShowingTrending) setupPagination(maxPages); else pagination.style.display = 'none'; } else { showNoResults(); } } catch (err) { showNoResults('Error al consultar la API.'); } finally { isLoading = false; showLoading(false); } }
        async function loadTrendingScripts() { if (isLoading) return; isShowingTrending = true; currentQuery = ''; searchInput.value = ''; currentPage = 1; await fetchScripts(); }
        function setupPagination(totalPages) { if (isShowingTrending || totalPages <= 1) { pagination.style.display = 'none'; return; } pagination.style.display = 'flex'; pagination.innerHTML = ''; pagination.appendChild(createPaginationButton('‹ Anterior', currentPage - 1, currentPage <= 1)); let startPage = Math.max(1, currentPage - 2), endPage = Math.min(totalPages, startPage + 4); if (endPage - startPage < 4) startPage = Math.max(1, endPage - 4); if (startPage > 1) { pagination.appendChild(createPaginationButton('1', 1)); if (startPage > 2) pagination.insertAdjacentHTML('beforeend', '<span class="pagination-dots">...</span>'); } for (let i = startPage; i <= endPage; i++) pagination.appendChild(createPaginationButton(i, i, false, i === currentPage)); if (endPage < totalPages) { if (endPage < totalPages - 1) pagination.insertAdjacentHTML('beforeend', '<span class="pagination-dots">...</span>'); pagination.appendChild(createPaginationButton(totalPages, totalPages)); } pagination.appendChild(createPaginationButton('Siguiente ›', currentPage + 1, currentPage >= totalPages)); }
        function createPaginationButton(text, page, disabled = false, active = false) { const btn = document.createElement('button'); btn.className = `page-btn ${active ? 'active' : ''}`; btn.textContent = text; btn.disabled = disabled; if (!disabled) btn.onclick = () => changePage(page); return btn; }
        async function changePage(newPage) { if (newPage === currentPage || isLoading) return; currentPage = newPage; window.scrollTo({ top: 0, behavior: 'smooth' }); await fetchScripts(); }
        function hideAllResults() { resultsHeader.style.display = 'none'; noResults.style.display = 'none'; scriptsGrid.innerHTML = ''; pagination.style.display = 'none'; }
        function renderScripts(scripts) { scriptsGrid.innerHTML = scripts.map(s => { const id = s.id || '', title = sanitize(s.title || ''), game = sanitize(s.game || ''), desc = sanitize(s.description || ''), rawUrl = sanitize(s.rawScript || ''); const tags = []; if(s.verified) tags.push('<span class="script-tag" style="background: #28a745;">✅ Verificado</span>'); if(s.universal) tags.push('<span class="script-tag" style="background: #8b5cf6;">🌐 Universal</span>'); if(s.keySystem) tags.push('<span class="script-tag" style="background: #f59e0b;">🔐 Key System</span>'); if(s.patched) tags.push('<span class="script-tag" style="background: #dc3545;">⚠️ Parcheado</span>'); tags.push(`<span class="script-tag" style="background: ${s.source==='ScriptBlox'?'#3b82f6':'#dc2626'};">${s.source}</span>`); return `<div class="script-card" data-id="${id}" data-title="${title}" data-raw-url="${rawUrl}"><div class="script-header"><h3 class="script-title">${title}</h3><span class="script-game">${game}</span></div><div class="script-tags">${tags.join('')}</div><p class="script-description">${desc}</p><div class="script-actions"><button class="copy-btn" onclick="copyScript(this)">Copiar</button><button class="view-btn" onclick="viewScript(this)">Ver Script</button></div></div>`; }).join(''); }
        function updateHeader(total, page, totalPages) { resultsHeader.style.display = 'flex'; resultsCount.textContent = `Resultados: ${total}`; pageInfo.textContent = isShowingTrending ? 'Recientes' : `${page} / ${totalPages}`; }
        async function viewScript(btn) { const card = btn.closest('.script-card'), id = card.dataset.id, title = card.dataset.title; if (!id) return; modalTitle.textContent = title || 'Cargando...'; modalCode.textContent = 'Obteniendo script...'; scriptModal.classList.add('show'); try { let content = ''; if (currentAPI === 'scriptblox') { const data = await makeAPIRequest(`${SCRIPTBLOX_API}/${id}`); content = data?.script?.script || ''; } else { const rawUrl = card.dataset.rawUrl; if (!rawUrl) throw new Error('URL no encontrada'); const res = await fetch(rawUrl); if (!res.ok) throw new Error('No se pudo cargar'); content = await res.text(); } modalCode.textContent = content.trim() ? content : 'Contenido no disponible.'; } catch (err) { modalCode.textContent = `Error: ${err.message}`; } }
        async function copyScript(btn) { const card = btn.closest('.script-card'), id = card.dataset.id; if (!id) return; showNotification('Obteniendo script...', 'success'); try { let content = ''; if (currentAPI === 'scriptblox') { const res = await fetch(`${SCRIPTBLOX_API}/raw/${id}`); content = res.ok ? await res.text() : ''; if (!content) { const data = await makeAPIRequest(`${SCRIPTBLOX_API}/${id}`); content = data?.script?.script || ''; } } else { const rawUrl = card.dataset.rawUrl; if (!rawUrl) throw new Error('URL no encontrada'); const res = await fetch(rawUrl); if (!res.ok) throw new Error('No se pudo obtener'); content = await res.text(); } if (!content.trim()) return showNotification('Contenido no disponible', 'error'); copyToClipboard(content); showNotification('Script copiado', 'success'); } catch (err) { showNotification(`Error al copiar: ${err.message}`, 'error'); } }
        function closeModal() { scriptModal.classList.remove('show'); }
        function copyModalScript() { const text = modalCode.textContent || ''; if (!text || text.includes('Error')) return; copyToClipboard(text); showNotification('Script copiado', 'success'); }
        function copyToClipboard(text) { navigator.clipboard.writeText(text).catch(() => { const ta = document.createElement('textarea'); ta.value = text; ta.style.position = 'fixed'; ta.style.left = '-9999px'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); }); }
        function sanitize(str) { const el = document.createElement('div'); el.innerText = str || ''; return el.innerHTML; }
        function showLoading(show) { loadingState.style.display = show ? 'block' : 'none'; }
        function showNoResults(message) { noResults.querySelector('p').textContent = message || 'No se encontraron scripts.'; noResults.style.display = 'block'; resultsHeader.style.display = 'none'; pagination.style.display = 'none'; }
        function clearSearch() { searchInput.value = ''; currentQuery = ''; currentSort = 'date'; currentOrder = 'desc'; currentVerified = ''; sortFilter.value = 'date'; orderFilter.value = 'desc'; verifiedFilter.value = ''; currentPage = 1; loadTrendingScripts(); }
        function showNotification(text, type = 'success') { const el = document.createElement('div'); el.className = `notification ${type}`; el.textContent = text; document.body.appendChild(el); setTimeout(() => el.classList.add('show'), 10); setTimeout(() => { el.classList.remove('show'); setTimeout(() => el.remove(), 200); }, 3000); }
        window.selectAPI = selectAPI; window.viewScript = viewScript; window.copyScript = copyScript; window.copyModalScript = copyModalScript; window.closeModal = closeModal; window.clearSearch = clearSearch;
</script>

</body>
</html>
