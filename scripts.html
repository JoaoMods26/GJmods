<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GJMODS - Buscador de Scripts</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap"
        rel="stylesheet"
    />
    <style>
        /* === ESTILOS ORIGINALES (sin cambios relevantes) === */
        body {
            font-family: "Inter", sans-serif;
            background: #0a0a0a;
            color: #fff;
            margin: 0;
            padding-top: 70px;
        }
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            height: 70px;
            background: rgba(10, 10, 10, 0.9);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            z-index: 100;
        }
        .navbar.scrolled {
            background: rgba(10, 10, 10, 0.95);
        }
        .navbar-logo {
            font-size: 1.5rem;
            font-weight: 900;
            background: linear-gradient(45deg, #3b82f6, #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .search-section {
            margin: 2rem;
        }
        .search-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1rem;
        }
        .search-form {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            color: #fff;
        }
        .search-btn {
            padding: 0.75rem 2rem;
            background: linear-gradient(45deg, #1e40af, #3b82f6);
            color: #fff;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
        }
        .scripts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }
        .script-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.8rem;
            padding: 1rem;
        }
        .script-header {
            display: flex;
            justify-content: space-between;
        }
        .script-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .copy-btn,
        .view-btn {
            flex: 1;
            padding: 0.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            color: #fff;
        }
        .copy-btn {
            background: linear-gradient(45deg, #28a745, #059669);
        }
        .view-btn {
            background: linear-gradient(45deg, #1e40af, #3b82f6);
        }
        .loading {
            text-align: center;
            padding: 2rem;
        }
        .notification {
            position: fixed;
            top: 90px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(300px);
            transition: transform 0.3s ease;
        }
        .notification.show {
            transform: translateX(0);
        }
        .notification.success {
            background: rgba(40, 167, 69, 0.9);
        }
        .notification.error {
            background: rgba(220, 53, 69, 0.9);
        }
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background: #1a1a2e;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            color: #e2e8f0;
        }
        .script-code {
            white-space: pre-wrap;
            background: #111827;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <nav class="navbar" id="navbar">
        <div class="navbar-logo">GJMODS</div>
    </nav>

    <main>
        <section class="search-section">
            <div class="search-container">
                <form class="search-form" id="searchForm">
                    <input
                        type="text"
                        id="searchInput"
                        class="search-input"
                        placeholder="Buscar scripts..."
                    />
                    <button type="submit" class="search-btn">Buscar</button>
                    <button
                        type="button"
                        class="search-btn"
                        style="background: linear-gradient(45deg, #dc2626, #e11d48);"
                        onclick="loadTrendingScripts()"
                    >
                        ðŸ”¥ Trending
                    </button>
                </form>
            </div>
        </section>

        <div class="loading" id="loadingState" style="display:none;">
            <p>Cargando...</p>
        </div>
        <div class="scripts-grid" id="scriptsGrid"></div>
    </main>

    <!-- Modal -->
    <div class="modal" id="scriptModal">
        <div class="modal-content">
            <h3 id="modalTitle">Vista previa</h3>
            <pre class="script-code" id="modalCode"></pre>
            <button
                class="copy-btn"
                style="width:100%;margin-top:1rem;"
                onclick="copyModalScript()"
            >
                Copiar Script
            </button>
        </div>
    </div>

    <script>
        // === CONFIG Y ESTADO ===
        const SCRIPTBLOX_API_SEARCH = "https://scriptblox.com/api/script/search";
        const SCRIPTBLOX_API_TRENDING = "https://scriptblox.com/api/script/trending";
        const SCRIPTBLOX_API_GET = "https://scriptblox.com/api/script";
        const SCRIPTS_PER_PAGE = 20;

        let currentQuery = "";
        let currentPage = 1;
        let isTrending = true;
        let debounceTimer = null;
        const cache = { search: {}, trending: {} };

        // === DOM ===
        const searchForm = document.getElementById("searchForm");
        const searchInput = document.getElementById("searchInput");
        const scriptsGrid = document.getElementById("scriptsGrid");
        const loadingState = document.getElementById("loadingState");
        const modal = document.getElementById("scriptModal");
        const modalCode = document.getElementById("modalCode");
        const modalTitle = document.getElementById("modalTitle");

        searchForm.addEventListener("submit", (e) => {
            e.preventDefault();
            currentQuery = searchInput.value.trim();
            currentPage = 1;
            isTrending = false;
            fetchScripts();
        });

        searchInput.addEventListener("input", () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                if (searchInput.value.trim()) {
                    currentQuery = searchInput.value.trim();
                    currentPage = 1;
                    isTrending = false;
                    fetchScripts();
                }
            }, 500);
        });

        function showLoading(show) {
            loadingState.style.display = show ? "block" : "none";
        }

        async function fetchScripts() {
            showLoading(true);
            scriptsGrid.innerHTML = "";
            const cacheKey = `${currentQuery}_${currentPage}`;
            if (cache.search[cacheKey]) {
                renderScripts(cache.search[cacheKey]);
                showLoading(false);
                return;
            }
            try {
                const url = `${SCRIPTBLOX_API_SEARCH}?q=${encodeURIComponent(
                    currentQuery
                )}&page=${currentPage}`;
                const res = await fetch(url);
                const data = await res.json();
                const scripts =
                    data?.result?.scripts || data?.result?.data || [];
                cache.search[cacheKey] = scripts;
                renderScripts(scripts);
            } catch (err) {
                console.error(err);
                showNotification("Error al buscar scripts", "error");
            } finally {
                showLoading(false);
            }
        }

        async function loadTrendingScripts() {
            showLoading(true);
            scriptsGrid.innerHTML = "";
            const cacheKey = `trending_${currentPage}`;
            if (cache.trending[cacheKey]) {
                renderScripts(cache.trending[cacheKey]);
                showLoading(false);
                return;
            }
            try {
                const res = await fetch(`${SCRIPTBLOX_API_TRENDING}?page=${currentPage}`);
                const data = await res.json();
                const scripts = data?.result || [];
                cache.trending[cacheKey] = scripts;
                renderScripts(scripts);
            } catch (err) {
                console.error(err);
                showNotification("Error al cargar trending", "error");
            } finally {
                showLoading(false);
            }
        }

        function renderScripts(scripts) {
            if (!scripts || scripts.length === 0) {
                scriptsGrid.innerHTML =
                    "<p style='text-align:center;'>No hay resultados</p>";
                return;
            }
            scriptsGrid.innerHTML = scripts
                .map((s) => {
                    const id = s._id || s.id || "";
                    const title = s.title || s.scriptTitle || "Script";
                    const gameName =
                        (s.game && s.game.name) || s.game_name || "Juego";
                    const desc = s.description || s.desc || "";
                    return `
                        <div class="script-card">
                            <div class="script-header">
                                <h4>${sanitize(title)}</h4>
                                <span>${sanitize(gameName)}</span>
                            </div>
                            <p>${sanitize(desc)}</p>
                            <div class="script-actions">
                                <button class="view-btn" onclick="viewScript('${id}')">Ver</button>
                            </div>
                        </div>
                    `;
                })
                .join("");
        }

        async function viewScript(id) {
            if (!id) return;
            try {
                const res = await fetch(`${SCRIPTBLOX_API_GET}/${id}`);
                const data = await res.json();
                const script = data?.result?.script || "Sin contenido";
                modalTitle.textContent =
                    data?.result?.title || "Vista previa del script";
                modalCode.textContent = script;
                modal.classList.add("show");
            } catch (err) {
                console.error(err);
                showNotification("Error al cargar script", "error");
            }
        }

        function copyModalScript() {
            navigator.clipboard.writeText(modalCode.textContent).then(() => {
                showNotification("Script copiado", "success");
            });
        }

        function sanitize(str) {
            return String(str).replace(/[&<>"']/g, (c) => {
                return {
                    "&": "&amp;",
                    "<": "&lt;",
                    ">": "&gt;",
                    '"': "&quot;",
                    "'": "&#39;",
                }[c];
            });
        }

        modal.addEventListener("click", (e) => {
            if (e.target === modal) modal.classList.remove("show");
        });

        function showNotification(text, type = "success") {
            const n = document.createElement("div");
            n.className = `notification ${type}`;
            n.textContent = text;
            document.body.appendChild(n);
            requestAnimationFrame(() => n.classList.add("show"));
            setTimeout(() => {
                n.classList.remove("show");
                setTimeout(() => n.remove(), 300);
            }, 2500);
        }

        // Cargar trending al inicio
        loadTrendingScripts();
    </script>
</body>
</html>
